<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulación de Transacción</title>
    <script>
        function simularTransaccion(id_usuario) {
            // Obtener la cantidad introducida por el usuario
            const cantidad = document.getElementById('cantidad').value;

            // Comprobar que se haya introducido una cantidad
            if (!cantidad) {
                alert('Por favor, introduce una cantidad.');
                return;
            }

            // Crear un objeto FormData para enviar los datos
            const formData = new FormData();
            formData.append('cantidad', cantidad);  // Aquí es donde se agrega la cantidad

            // Hacer la solicitud Fetch para simular la transacción
            fetch(`/simulate-transaction/${id_usuario}/`, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',  // Indicar que es una solicitud AJAX
                },
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error en la transacción: ' + response.statusText);
                }
                return response.json();  // Convertir la respuesta a JSON
            })
            .then(data => {
                // Actualizar el saldo en la página con el nuevo saldo
                document.getElementById('saldo').textContent = data.nuevo_saldo;
                alert(`Nuevo saldo: ${data.nuevo_saldo}`);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Ocurrió un error: ' + error.message);
            });
        }
    </script>
</head>
<body>
    <h1>Simulación de Transacción</h1>

    <!-- Campo para que el usuario ingrese la cantidad -->
    <label for="cantidad">Cantidad a agregar:</label>
    <input type="number" id="cantidad" placeholder="Escribe la cantidad" step="0.01" required>

    <!-- Botón para agregar saldo -->
    <button onclick="simularTransaccion('{{ id_usuario }}')">Agregar Saldo</button>

    <!-- Muestra el saldo actual -->
    <p>Saldo actual: <span id="saldo">{{ user.saldo }}</span></p>
</body>
</html>
